import{computed as g,defineComponent as T,h as S,inject as _,nextTick as oe,onMounted as j,onUnmounted as ae,provide as ne,ref as y,watchEffect as q}from"vue";import{render as P,Features as G}from'../../utils/render.js';import{Keys as re}from'../../keyboard.js';import{useId as E}from'../../hooks/use-id.js';import{FocusTrap as C}from'../../components/focus-trap/focus-trap.js';import{useInertOthers as ie}from'../../hooks/use-inert-others.js';import{Portal as z,PortalGroup as se}from'../portal/portal.js';import{StackMessage as J,useStackProvider as ue}from'../../internal/stack-context.js';import{match as A}from'../../utils/match.js';import{ForcePortalRoot as B}from'../../internal/portal-force-root.js';import{Description as de,useDescriptions as pe}from'../description/description.js';import{dom as Q}from'../../utils/dom.js';import{useOpenClosed as fe,State as X}from'../../internal/open-closed.js';import{useOutsideClick as ce}from'../../hooks/use-outside-click.js';import{getOwnerDocument as ge}from'../../utils/owner.js';import{useEventListener as me}from'../../hooks/use-event-listener.js';import{Hidden as ve,Features as De}from'../../internal/hidden.js';import{disposables as he}from'../../utils/disposables.js';import{isIOS as Se}from'../../utils/platform.js';var ye=(t=>(t[t.Open=0]="Open",t[t.Closed=1]="Closed",t))(ye||{});let W=Symbol("DialogContext");function R(l){let i=_(W,null);if(i===null){let t=new Error(`<${l} /> is missing a parent <Dialog /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(t,R),t}return i}let M="DC8F892D-2EBD-447C-A4C8-A03058436FF4",Ue=T({name:"Dialog",inheritAttrs:!1,props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},open:{type:[Boolean,String],default:M},initialFocus:{type:Object,default:null},id:{type:String,default:()=>`headlessui-dialog-${E()}`}},emits:{close:l=>!0},setup(l,{emit:i,attrs:t,slots:u,expose:s}){var K;let o=y(!1);j(()=>{o.value=!0});let d=y(0),D=fe(),h=g(()=>l.open===M&&D!==null?A(D.value,{[X.Open]:!0,[X.Closed]:!1}):l.open),H=y(new Set),m=y(null),V=y(null),x=g(()=>ge(m));if(s({el:m,$el:m}),!(l.open!==M||D!==null))throw new Error("You forgot to provide an `open` prop to the `Dialog`.");if(typeof h.value!="boolean")throw new Error(`You provided an \`open\` prop to the \`Dialog\`, but the value is not a boolean. Received: ${h.value===M?void 0:l.open}`);let c=g(()=>o.value&&h.value?0:1),Y=g(()=>c.value===0),k=g(()=>d.value>1),Z=_(W,null)!==null,ee=g(()=>k.value?"parent":"leaf");ie(m,g(()=>k.value?Y.value:!1)),ue({type:"Dialog",enabled:g(()=>c.value===0),element:m,onUpdate:(a,e,n)=>{if(e==="Dialog")return A(a,{[J.Add](){H.value.add(n),d.value+=1},[J.Remove](){H.value.delete(n),d.value-=1}})}});let te=pe({name:"DialogDescription",slot:g(()=>({open:h.value}))}),L=y(null),b={titleId:L,panelRef:y(null),dialogState:c,setTitleId(a){L.value!==a&&(L.value=a)},close(){i("close",!1)}};ne(W,b);function I(){var e,n,v;return[...Array.from((n=(e=x.value)==null?void 0:e.querySelectorAll("body > *, [data-headlessui-portal]"))!=null?n:[]).filter(r=>!(!(r instanceof HTMLElement)||r.contains(Q(V))||b.panelRef.value&&r.contains(b.panelRef.value))),(v=b.panelRef.value)!=null?v:m.value]}return ce(()=>I(),(a,e)=>{b.close(),oe(()=>e==null?void 0:e.focus())},g(()=>c.value===0&&!k.value)),me((K=x.value)==null?void 0:K.defaultView,"keydown",a=>{a.defaultPrevented||a.key===re.Escape&&c.value===0&&(k.value||(a.preventDefault(),a.stopPropagation(),b.close()))}),q(a=>{var U;if(c.value!==0||Z)return;let e=x.value;if(!e)return;let n=he(),v=window.pageYOffset;function r(f,p,w){let F=f.style.getPropertyValue(p);return Object.assign(f.style,{[p]:w}),n.add(()=>{Object.assign(f.style,{[p]:F})})}let O=e==null?void 0:e.documentElement,N=((U=e.defaultView)!=null?U:window).innerWidth-O.clientWidth;if(r(O,"overflow","hidden"),N>0){let f=O.clientWidth-O.offsetWidth,p=N-f;r(O,"paddingRight",`${p}px`)}if(Se()){r(e.body,"marginTop",`-${v}px`),window.scrollTo(0,0);let f=null;n.addEventListener(e,"click",p=>{if(p.target instanceof HTMLElement)try{let w=p.target.closest("a");if(!w)return;let{hash:F}=new URL(w.href),$=e.querySelector(F);$&&!I().some(le=>le.contains($))&&(f=$)}catch{}},!0),n.addEventListener(e,"touchmove",p=>{p.target instanceof HTMLElement&&!I().some(w=>w.contains(p.target))&&p.preventDefault()},{passive:!1}),n.add(()=>{window.scrollTo(0,window.pageYOffset+v),f&&f.isConnected&&(f.scrollIntoView({block:"nearest"}),f=null)})}a(n.dispose)}),q(a=>{if(c.value!==0)return;let e=Q(m);if(!e)return;let n=new IntersectionObserver(v=>{for(let r of v)r.boundingClientRect.x===0&&r.boundingClientRect.y===0&&r.boundingClientRect.width===0&&r.boundingClientRect.height===0&&b.close()});n.observe(e),a(()=>n.disconnect())}),()=>{let{id:a,open:e,initialFocus:n,...v}=l,r={...t,ref:m,id:a,role:"dialog","aria-modal":c.value===0?!0:void 0,"aria-labelledby":L.value,"aria-describedby":te.value},O={open:c.value===0};return S(B,{force:!0},()=>[S(z,()=>S(se,{target:m.value},()=>S(B,{force:!1},()=>S(C,{initialFocus:n,containers:H,features:Y.value?A(ee.value,{parent:C.features.RestoreFocus,leaf:C.features.All&~C.features.FocusLock}):C.features.None},()=>P({ourProps:r,theirProps:v,slot:O,attrs:t,slots:u,visible:c.value===0,features:G.RenderStrategy|G.Static,name:"Dialog"}))))),S(ve,{features:De.Hidden,ref:V})])}}}),_e=T({name:"DialogOverlay",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-overlay-${E()}`}},setup(l,{attrs:i,slots:t}){let u=R("DialogOverlay");function s(o){o.target===o.currentTarget&&(o.preventDefault(),o.stopPropagation(),u.close())}return()=>{let{id:o,...d}=l;return P({ourProps:{id:o,"aria-hidden":!0,onClick:s},theirProps:d,slot:{open:u.dialogState.value===0},attrs:i,slots:t,name:"DialogOverlay"})}}}),qe=T({name:"DialogBackdrop",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-backdrop-${E()}`}},inheritAttrs:!1,setup(l,{attrs:i,slots:t,expose:u}){let s=R("DialogBackdrop"),o=y(null);return u({el:o,$el:o}),j(()=>{if(s.panelRef.value===null)throw new Error("A <DialogBackdrop /> component is being used, but a <DialogPanel /> component is missing.")}),()=>{let{id:d,...D}=l,h={id:d,ref:o,"aria-hidden":!0};return S(B,{force:!0},()=>S(z,()=>P({ourProps:h,theirProps:{...i,...D},slot:{open:s.dialogState.value===0},attrs:i,slots:t,name:"DialogBackdrop"})))}}}),Ge=T({name:"DialogPanel",props:{as:{type:[Object,String],default:"div"},id:{type:String,default:()=>`headlessui-dialog-panel-${E()}`}},setup(l,{attrs:i,slots:t,expose:u}){let s=R("DialogPanel");u({el:s.panelRef,$el:s.panelRef});function o(d){d.stopPropagation()}return()=>{let{id:d,...D}=l,h={id:d,ref:s.panelRef,onClick:o};return P({ourProps:h,theirProps:D,slot:{open:s.dialogState.value===0},attrs:i,slots:t,name:"DialogPanel"})}}}),ze=T({name:"DialogTitle",props:{as:{type:[Object,String],default:"h2"},id:{type:String,default:()=>`headlessui-dialog-title-${E()}`}},setup(l,{attrs:i,slots:t}){let u=R("DialogTitle");return j(()=>{u.setTitleId(l.id),ae(()=>u.setTitleId(null))}),()=>{let{id:s,...o}=l;return P({ourProps:{id:s},theirProps:o,slot:{open:u.dialogState.value===0},attrs:i,slots:t,name:"DialogTitle"})}}}),Je=de;export{Ue as Dialog,qe as DialogBackdrop,Je as DialogDescription,_e as DialogOverlay,Ge as DialogPanel,ze as DialogTitle};
