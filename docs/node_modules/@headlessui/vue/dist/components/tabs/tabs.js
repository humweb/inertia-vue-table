import{Fragment as G,computed as c,defineComponent as E,h as M,inject as C,onMounted as H,onUnmounted as A,provide as j,ref as T,watchEffect as N}from"vue";import{Features as B,render as w,omit as U}from'../../utils/render.js';import{useId as F}from'../../hooks/use-id.js';import{Keys as v}from'../../keyboard.js';import{dom as I}from'../../utils/dom.js';import{match as W}from'../../utils/match.js';import{focusIn as P,Focus as m,FocusResult as O}from'../../utils/focus-management.js';import{useResolveButtonType as z}from'../../hooks/use-resolve-button-type.js';import{FocusSentinel as _}from'../../internal/focus-sentinel.js';import{microTask as q}from'../../utils/micro-task.js';import{Hidden as J}from'../../internal/hidden.js';import{getOwnerDocument as Q}from'../../utils/owner.js';let K=Symbol("TabsContext");function L(a){let o=C(K,null);if(o===null){let s=new Error(`<${a} /> is missing a parent <TabGroup /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(s,L),s}return o}let k=Symbol("TabsSSRContext"),de=E({name:"TabGroup",emits:{change:a=>!0},props:{as:{type:[Object,String],default:"template"},selectedIndex:{type:[Number],default:null},defaultIndex:{type:[Number],default:0},vertical:{type:[Boolean],default:!1},manual:{type:[Boolean],default:!1}},inheritAttrs:!1,setup(a,{slots:o,attrs:s,emit:p}){let t=T(null),n=T([]),u=T([]),g=c(()=>a.selectedIndex!==null),x=c(()=>g.value?a.selectedIndex:t.value),d={selectedIndex:c(()=>{var l,r;return(r=(l=t.value)!=null?l:a.defaultIndex)!=null?r:null}),orientation:c(()=>a.vertical?"vertical":"horizontal"),activation:c(()=>a.manual?"manual":"auto"),tabs:n,panels:u,setSelectedIndex(l){x.value!==l&&p("change",l),g.value||(t.value=l)},registerTab(l){n.value.includes(l)||n.value.push(l)},unregisterTab(l){let r=n.value.indexOf(l);r!==-1&&n.value.splice(r,1)},registerPanel(l){u.value.includes(l)||u.value.push(l)},unregisterPanel(l){let r=u.value.indexOf(l);r!==-1&&u.value.splice(r,1)}};j(K,d);let f=T({tabs:[],panels:[]}),h=T(!1);return H(()=>{h.value=!0}),j(k,c(()=>h.value?null:f.value)),N(()=>{var D;if(d.tabs.value.length<=0||a.selectedIndex===null&&t.value!==null)return;let l=d.tabs.value.map(e=>I(e)).filter(Boolean),r=l.filter(e=>!e.hasAttribute("disabled")),i=(D=a.selectedIndex)!=null?D:a.defaultIndex;if(i<0)t.value=l.indexOf(r[0]);else if(i>d.tabs.value.length)t.value=l.indexOf(r[r.length-1]);else{let e=l.slice(0,i),y=[...l.slice(i),...e].find(S=>r.includes(S));if(!y)return;t.value=l.indexOf(y)}}),()=>{let l={selectedIndex:t.value};return M(G,[n.value.length<=0&&M(_,{onFocus:()=>{for(let r of n.value){let i=I(r);if((i==null?void 0:i.tabIndex)===0)return i.focus(),!0}return!1}}),w({theirProps:{...s,...U(a,["selectedIndex","defaultIndex","manual","vertical","onChange"])},ourProps:{},slot:l,slots:o,attrs:s,name:"TabGroup"})])}}}),fe=E({name:"TabList",props:{as:{type:[Object,String],default:"div"}},setup(a,{attrs:o,slots:s}){let p=L("TabList");return()=>{let t={selectedIndex:p.selectedIndex.value},n={role:"tablist","aria-orientation":p.orientation.value};return w({ourProps:n,theirProps:a,slot:t,attrs:o,slots:s,name:"TabList"})}}}),ce=E({name:"Tab",props:{as:{type:[Object,String],default:"button"},disabled:{type:[Boolean],default:!1},id:{type:String,default:()=>`headlessui-tabs-tab-${F()}`}},setup(a,{attrs:o,slots:s,expose:p}){let t=L("Tab"),n=T(null);p({el:n,$el:n}),H(()=>t.registerTab(n)),A(()=>t.unregisterTab(n));let u=C(k),g=c(()=>{if(u.value){let e=u.value.tabs.indexOf(a.id);return e===-1?u.value.tabs.push(a.id)-1:e}return-1}),x=c(()=>{let e=t.tabs.value.indexOf(n);return e===-1?g.value:e}),d=c(()=>x.value===t.selectedIndex.value);function f(e){var y;let b=e();if(b===O.Success&&t.activation.value==="auto"){let S=(y=Q(n))==null?void 0:y.activeElement,R=t.tabs.value.findIndex($=>I($)===S);R!==-1&&t.setSelectedIndex(R)}return b}function h(e){let b=t.tabs.value.map(S=>I(S)).filter(Boolean);if(e.key===v.Space||e.key===v.Enter){e.preventDefault(),e.stopPropagation(),t.setSelectedIndex(x.value);return}switch(e.key){case v.Home:case v.PageUp:return e.preventDefault(),e.stopPropagation(),f(()=>P(b,m.First));case v.End:case v.PageDown:return e.preventDefault(),e.stopPropagation(),f(()=>P(b,m.Last))}if(f(()=>W(t.orientation.value,{vertical(){return e.key===v.ArrowUp?P(b,m.Previous|m.WrapAround):e.key===v.ArrowDown?P(b,m.Next|m.WrapAround):O.Error},horizontal(){return e.key===v.ArrowLeft?P(b,m.Previous|m.WrapAround):e.key===v.ArrowRight?P(b,m.Next|m.WrapAround):O.Error}}))===O.Success)return e.preventDefault()}let l=T(!1);function r(){var e;l.value||(l.value=!0,!a.disabled&&((e=I(n))==null||e.focus(),t.setSelectedIndex(x.value),q(()=>{l.value=!1})))}function i(e){e.preventDefault()}let D=z(c(()=>({as:a.as,type:o.type})),n);return()=>{var R;let e={selected:d.value},{id:b,...y}=a,S={ref:n,onKeydown:h,onMousedown:i,onClick:r,id:b,role:"tab",type:D.value,"aria-controls":(R=I(t.panels.value[x.value]))==null?void 0:R.id,"aria-selected":d.value,tabIndex:d.value?0:-1,disabled:a.disabled?!0:void 0};return w({ourProps:S,theirProps:y,slot:e,attrs:o,slots:s,name:"Tab"})}}}),be=E({name:"TabPanels",props:{as:{type:[Object,String],default:"div"}},setup(a,{slots:o,attrs:s}){let p=L("TabPanels");return()=>{let t={selectedIndex:p.selectedIndex.value};return w({theirProps:a,ourProps:{},slot:t,attrs:s,slots:o,name:"TabPanels"})}}}),pe=E({name:"TabPanel",props:{as:{type:[Object,String],default:"div"},static:{type:Boolean,default:!1},unmount:{type:Boolean,default:!0},id:{type:String,default:()=>`headlessui-tabs-panel-${F()}`}},setup(a,{attrs:o,slots:s,expose:p}){let t=L("TabPanel"),n=T(null);p({el:n,$el:n}),H(()=>t.registerPanel(n)),A(()=>t.unregisterPanel(n));let u=C(k),g=c(()=>{if(u.value){let f=u.value.panels.indexOf(a.id);return f===-1?u.value.panels.push(a.id)-1:f}return-1}),x=c(()=>{let f=t.panels.value.indexOf(n);return f===-1?g.value:f}),d=c(()=>x.value===t.selectedIndex.value);return()=>{var i;let f={selected:d.value},{id:h,...l}=a,r={ref:n,id:h,role:"tabpanel","aria-labelledby":(i=I(t.tabs.value[x.value]))==null?void 0:i.id,tabIndex:d.value?0:-1};return!d.value&&a.unmount&&!a.static?M(J,{as:"span",...r}):w({ourProps:r,theirProps:l,slot:f,attrs:o,slots:s,features:B.Static|B.RenderStrategy,visible:d.value,name:"TabPanel"})}}});export{ce as Tab,de as TabGroup,fe as TabList,pe as TabPanel,be as TabPanels};
